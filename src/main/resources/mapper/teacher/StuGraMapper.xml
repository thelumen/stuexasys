<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="sunday.mapper.teacher.StuGraMapper">

    <!--更新学生成绩-->
    <update id="updateGrade" parameterType="sunday.pojo.teacher.GradeTaken">
        UPDATE com_grade
        <set>
            <if test="grade1 != null">
                grade1 = #{grade1,jdbcType=INTEGER},
            </if>
            <if test="grade2 != null">
                grade2 = #{grade2,jdbcType=INTEGER},
            </if>
            <if test="grade3 != null">
                grade3 = #{grade3,jdbcType=INTEGER},
            </if>
            <if test="grade4 != null">
                grade4 = #{grade4,jdbcType=INTEGER},
            </if>
            <if test="total != null">
                total = #{total,jdbcType=INTEGER},
            </if>
        </set>
        WHERE studentId = #{studentId,jdbcType=INTEGER} AND courseId =#{courseId,jdbcType=INTEGER}
    </update>

    <!--查询学生成绩-->
    <select id="selectGradeTaken" parameterType="java.util.Map"
            resultType="sunday.pojo.teacher.GradeTaken">
        SELECT DISTINCT g.studentId AS studentId,s.name AS studentName,c.name AS
        courseName, g.grade1 AS grade1,g.grade2 AS grade2,g.grade3 AS
        grade3,g.grade4 AS grade4,g.total AS total,p.name AS
        specialtyName,p.specialtyId AS specialtyId ,c.courseId AS courseId
        FROM com_teacher_l_course l,com_teacher t,com_course c,com_grade
        g,com_student s,com_specialty p
        WHERE l.courseId=c.courseId AND l.specialtyId=p.specialtyId AND
        l.teacherId=t.teacherId
        AND g.courseId=c.courseId AND g.studentId=s.studentId AND
        s.specialtyId=p.specialtyId
        <if test="teacherId != null">
            AND t.teacherId=#{teacherId,jdbcType=INTEGER}
        </if>
        <if test="specialtyName != null">
            AND p.name=#{specialtyName,jdbcType=VARCHAR}
        </if>
        <if test="specialtyId != null">
            AND p.specialtyId=#{specialtyId,jdbcType=INTEGER}
        </if>
        <if test="courseId != null">
            AND c.courseId=#{courseId,jdbcType=INTEGER}
        </if>
        ORDER BY p.specialtyId ASC
    </select>

    <!--更新附加题成绩-->
    <update id="updateAnother">
        UPDATE com_grade
        SET grade4=#{score,jdbcType=INTEGER}
        WHERE studentId = #{studentId,jdbcType=INTEGER} AND courseId =
        #{courseId,jdbcType=INTEGER}
    </update>
</mapper>