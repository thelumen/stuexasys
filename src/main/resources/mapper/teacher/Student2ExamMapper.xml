<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="sunday.mapper.teacher.Student2ExamMapper">
    <!--新增考试信息-->
    <insert id="insertExamInfo" parameterType="sunday.pojo.teacher.ExamTaken">
        INSERT INTO com_examinfo(teacherId,specialtyId,courseId,started)
        VALUES (#{teacherId,jdbcType=INTEGER},#{specialtyId,jdbcType=INTEGER},#{courseId,jdbcType=INTEGER},#{started,jdbcType=INTEGER})
    </insert>

    <!--查询考试信息-->
    <select id="selectExamTaken" parameterType="java.util.Map"
            resultType="sunday.pojo.teacher.ExamTaken">
        SELECT
        e.id,
        e.teacherId,
        c.courseId,
        c.name AS courseName,
        s.specialtyId,
        s.name AS specialtyName,
        e.content1,
        e.date1,
        e.sign1,
        e.content2,
        e.date2,
        e.sign2,
        e.content3,
        e.date3,
        e.sign3,
        e.date4,
        e.sign4,
        e.started
        FROM com_examinfo e, com_course c, com_specialty s
        WHERE e.courseId = c.courseId AND e.specialtyId = s.specialtyId
        <if test="teacherId != null">
            AND e.teacherId=#{teacherId,jdbcType=INTEGER}
        </if>
        <if test="courseId != null">
            AND e.courseId=#{courseId,jdbcType=INTEGER}
        </if>
        <if test="specialtyId != null">
            AND e.specialtyId=#{specialtyId,jdbcType=INTEGER}
        </if>
    </select>

    <!--更新考试信息-->
    <update id="updateExamInfo" parameterType="sunday.pojo.teacher.ExamTaken">
        UPDATE com_examinfo
        <set>
            <if test="content1 != null">
                content1 = #{content1,jdbcType=VARCHAR},
            </if>
            <if test="date1 != null">
                date1 = #{date1,jdbcType=DATE},
            </if>
            <if test="sign1 != null">
                sign1 = #{sign1,jdbcType=INTEGER},
            </if>
            <if test="content2 != null">
                content2 = #{content2,jdbcType=VARCHAR},
            </if>
            <if test="date2 != null">
                date2 = #{date2,jdbcType=DATE},
            </if>
            <if test="sign2 != null">
                sign2 = #{sign2,jdbcType=INTEGER},
            </if>
            <if test="content3 != null">
                content3 = #{content3,jdbcType=VARCHAR},
            </if>
            <if test="date3 != null">
                date3 = #{date3,jdbcType=DATE},
            </if>
            <if test="sign3 != null">
                sign3 = #{sign3,jdbcType=INTEGER},
            </if>
            <if test="date4 != null">
                date4 = #{date4,jdbcType=DATE},
            </if>
            <if test="sign4 != null">
                sign4 = #{sign4,jdbcType=INTEGER},
            </if>
            <if test="started != null">
                started = #{started,jdbcType=INTEGER},
            </if>
        </set>
        WHERE id = #{id,jdbcType=INTEGER}
    </update>

    <!--删除考试信息-->
    <delete id="deleteExamInfo" parameterType="java.lang.String">
        DELETE FROM com_examinfo
        WHERE teacherId=#{teacherId,jdbcType=INTEGER} AND courseId=#{courseId,jdbcType=INTEGER} AND specialtyId=#{specialtyId,jdbcType=INTEGER}
    </delete>

    <!--获取modal中table的考试信息-->
    <select id="selectTableExamInfo" parameterType="java.util.Map"
            resultType="sunday.pojo.teacher.ExamTaken">
        SELECT e.id,c.name AS courseName,s.name AS specialtyName,e.test
        FROM com_examinfo e,com_course c,com_specialty s
        WHERE e.courseId=c.courseId AND e.specialtyId=s.specialtyId
        <if test="teacherId != null">
            AND e.teacherId=#{teacherId,jdbcType=INTEGER}
        </if>
    </select>

    <!--开启/关闭考试-->
    <update id="startOrCloseExam" parameterType="java.util.Map">
        UPDATE com_examinfo
        <set>
            <if test="test != null">
                test = #{test,jdbcType=INTEGER},
            </if>
        </set>
        WHERE id=#{id,jdbcType=INTEGER}
    </update>
</mapper>